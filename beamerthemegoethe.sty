% !TeX root = main.tex
\mode<presentation>

%% Layout Options 
% Outer Theme Options
\DeclareOptionBeamer{frametitlemargin}{\PassOptionsToPackage{frametitlemargin={#1}}{beamerouterthemegoethe}}
\DeclareOptionBeamer{framefootermargin}{\PassOptionsToPackage{framefootermargin={#1}}{beamerouterthemegoethe}}

% Inner Theme Options
\DeclareOptionBeamer{titleheight}{\PassOptionsToPackage{titleheight=#1}{beamerinnerthemegoethe}}
\DeclareOptionBeamer{titledepth}{\PassOptionsToPackage{titledepth=#1}{beamerinnerthemegoethe}}
\DeclareOptionBeamer{titlemargin}{\PassOptionsToPackage{titlemargin=#1}{beamerinnerthemegoethe}}
\DeclareOptionBeamer{centertitle}{\PassOptionsToPackage{centertitle}{beamerinnerthemegoethe}}
\DeclareOptionBeamer{sectionheight}{\PassOptionsToPackage{sectionheight=#1}{beamerinnerthemegoethe}}
\DeclareOptionBeamer{logo}{\PassOptionsToPackage{logo={#1}}{beamerinnerthemegoethe}}
\DeclareOptionBeamer{nologo}{\PassOptionsToPackage{nologo}{beamerinnerthemegoethe}}
\DeclareOptionBeamer{logowidth}{\PassOptionsToPackage{logowidth=#1}{beamerinnerthemegoethe}}
\DeclareOptionBeamer{centerlogo}{\PassOptionsToPackage{centerlogo}{beamerinnerthemegoethe}}

% Color Theme Options
\DeclareOptionBeamer{usettlabcolors}{\PassOptionsToPackage{usettlabcolors}{beamercolorthemegoethe}}
\DeclareOptionBeamer{usematerialcolors}{\PassOptionsToPackage{usematerialcolors}{beamercolorthemegoethe}}
\DeclareOptionBeamer{usealphabetcolors}{\PassOptionsToPackage{usealphabetcolors}{beamercolorthemegoethe}}
\DeclareOptionBeamer{usegreenarmytagecolors}{\PassOptionsToPackage{usegreenarmytagecolors}{beamercolorthemegoethe}}

% Layout Options
\DeclareOptionBeamer{nonavigation}{\setbeamertemplate{navigation symbols}{}}

%% Common Options
\newcommand{\polyglossiaLang}{english}
\DeclareOptionBeamer{english}{
    \PassOptionsToPackage{english}{babel}%
    \renewcommand{\polyglossiaLang}{english}%
}
\DeclareOptionBeamer{german}{
    \PassOptionsToPackage{ngerman}{babel}%
    \renewcommand{\polyglossiaLang}{german}%
}
\DeclareOptionBeamer{ngerman}{
    \PassOptionsToPackage{ngerman}{babel}%
    \renewcommand{\polyglossiaLang}{german}%
}

\newif\if@polyglossia
\DeclareOptionBeamer{usepolyglossia}{\@polyglossiatrue}
\DeclareOptionBeamer{nopolyglossia}{\@polyglossiafalse}
\DeclareOptionBeamer{usebabel}{\@polyglossiafalse}
\ExecuteOptions{usebabel}

\newif\if@biblatex
\DeclareOptionBeamer{usebiblatex}{\@biblatextrue}
\DeclareOptionBeamer{usenatbib}{\@biblatexfalse}
\ExecuteOptions{usebiblatex}

\DeclareOptionBeamer{biblatexbackend}{\PassOptionsToPackage{backend=#1}{biblatex}}
\ExecuteOptions{biblatexbackend=bibtex}

\newif\if@cleveref
\DeclareOptionBeamer{usecleveref}{\@clevereftrue}
\DeclareOptionBeamer{nocleveref}{\@clevereffalse}
\ExecuteOptions{nocleveref}

\newif\if@libertine
\DeclareOptionBeamer{uselibertine}{\@libertinetrue}
\DeclareOptionBeamer{nolibertine}{\@libertinefalse}
\ExecuteOptions{nolibertine}

\newif\if@firacode
\DeclareOptionBeamer{usefiracode}{\@firacodetrue}
\DeclareOptionBeamer{nofiracode}{\@firacodefalse}
\ExecuteOptions{nofiracode}

\newif\if@minted
\DeclareOptionBeamer{useminted}{\@mintedtrue}
\DeclareOptionBeamer{nominted}{\@mintedfalse}
\ExecuteOptions{nominted}

\newif\if@tikz
\DeclareOptionBeamer{usetikz}{\@tikztrue}
\DeclareOptionBeamer{notikz}{\@tikzfalse}
\ExecuteOptions{usetikz}

\ProcessOptionsBeamer\relax

\newcommand{\printsection}{\let\hyperlink\@secondoftwo\insertsection}
\newcommand{\printsubsection}{\let\hyperlink\@secondoftwo\insertsubsection}

\usecolortheme{goethe}
\usefonttheme{goethe}
\useoutertheme{goethe}
\useinnertheme{goethe}

% \setbeamertemplate{bibliography item}{\insertbiblabel}
\setbeamertemplate{bibliography item}{}

\setbeamertemplate{sections/subsections in toc}[sections numbered]
\setbeamertemplate{sections/subsections in toc shaded}[goethe][60]

\renewcommand{\And}{\texorpdfstring{\\}{, }}

%Set fonts if they are installed
% \usepackage{fontspec}
% \IfFontExistsTF{Vestula}{
% 	\setsansfont{Vestula}
% 	}{
% 	\IfFontExistsTF{Minion}{
% 		\setsansfont{Minion}
% 		}{
% 		}
% 	}
% \usefonttheme{professionalfonts}

\if@polyglossia
    \RequirePackage[english]{polyglossia}
    \setdefaultlanguage[]{\polyglossiaLang}
\else
    \usepackage[]{babel}
\fi

%% Settings %%

% 3 levels of section nestings
\setcounter{secnumdepth}{3}
% but only show two in the table of contents
\setcounter{tocdepth}{2}

% No paragraph indent
\setlength\parindent{0pt}
\addtolength\parskip{6pt}

%% Fonts %%
\RequirePackage{iftex}
\ifPDFTeX
    \RequirePackage[T1]{fontenc}
    \RequirePackage[utf8]{inputenc}
\fi
\ifXeTeX
    \ClassWarning{beamerthemegoethe}{Use LuaLaTeX instead of XeLaTeX}
\fi

\if@libertine%
    \RequirePackage{fontspec}
    \setromanfont[Ligatures=TeX]{Linux Libertine O} % Serifenschrift
    \setsansfont[Ligatures=TeX]{Linux Biolinum O} % serifenlose Schrift
    \setmonofont[Scale=MatchLowercase]{DejaVu Sans Mono}%
\fi%

\if@firacode%
    \RequirePackage{fontspec}
    \setmonofont{FiraCode-Regular.ttf}[
        Path={./fonts/},
        % Upright italic font for nice formatted minted comments
        ItalicFont={FiraCode-Light.ttf},
        BoldFont={FiraCode-SemiBold.ttf},
        % Fake slant in bold+italic
        BoldItalicFont={FiraCode-SemiBold.ttf},
        BoldItalicFeatures={FakeSlant=0.2},
        % Scale monofont by lowercase in regard to main roman font
        Scale=MatchLowercase,
        % Enable ligatures
        Ligatures=TeX,
        Contextuals={Alternate},
        % Enable tradtional & and @, and thin backlash \\
        StylisticSet={3,5,6}
    ]
\fi

\RequirePackage{relsize}

%% Bibliography %%
\if@biblatex%
    \usepackage[
        style=authoryear-icomp,
        citestyle=authoryear,
        natbib=true,
    ]{biblatex}
    \DefineBibliographyStrings{german}{%
        andothers = {et\addabbrvspace al\adddot}
    }
    \DefineBibliographyStrings{ngerman}{%
        andothers = {et\addabbrvspace al\adddot}
    }
    \DefineBibliographyStrings{english}{%
        andothers = {et\addabbrvspace al\adddot}
    }
    \DeclareDelimFormat[coloncite]{postnotedelim}{\addcolon}
    \DeclareFieldFormat{postnote}{#1}

    \newbibmacro*{coloncite:postnote}{%
        \iffieldundef{postnote}
        {\ifbool{cbx:parens}
            {\bibcloseparen}
            {}}
        {\ifbool{cbx:parens}
            {\setunit{\printdelim[coloncite]{postnotedelim}}}
            {\setunit{\printdelim{extpostnotedelim}\bibopenparen}}%
        \printfield[coloncite]{postnote}\bibcloseparen}}

    \DeclareCiteCommand{\coloncite}
    {\boolfalse{cbx:parens}}
    {\usebibmacro{citeindex}%
    \iffirstcitekey
    {\setcounter{textcitetotal}{1}}
    {\stepcounter{textcitetotal}%
        \textcitedelim}%
    \usebibmacro{textcite}}
    {\ifbool{cbx:parens}
        {\bibcloseparen\global\boolfalse{cbx:parens}}
        {}}
    {\usebibmacro{coloncite:postnote}}

    \newbibmacro*{coloncitep:postnote}{%
        \iffieldundef{postnote}
        {}
        {\setunit{\printdelim[coloncite]{postnotedelim}}%
            \printfield[coloncite]{postnote}}}

    \DeclareCiteCommand{\coloncitep}[\mkbibparens]
    {\usebibmacro{prenote}}
    {\usebibmacro{citeindex}%
        \usebibmacro{cite}}
    {\multicitedelim}
    {\usebibmacro{coloncitep:postnote}}
\else%
    % From the ACL paper template
    % See: https://github.com/acl-org/acl-style-files
    \RequirePackage{natbib}
    % for citation commands in the .tex, authors can use:
    % \citep, \citet, and \citeyearpar for compatibility with natbib, or
    % \cite, \newcite, and \shortcite for compatibility with older ACL .sty files
    \renewcommand\cite{\citep}	% to get "(Author Year)" with natbib    
    \newcommand\shortcite{\citeyearpar}% to get "(Year)" with natbib    
    \newcommand\newcite{\citet}	% to get "Author (Year)" with natbib

    \bibliographystyle{misc/acl_natbib}
\fi

% Layout
\RequirePackage{scrhack}
\RequirePackage{microtype}

% Maths
\RequirePackage{amsmath} % AMS macros
\RequirePackage{amsthm} % Theorems
\RequirePackage{mathtools} % amsmath extension, e.g. \coloneqq (:=)

\RequirePackage[np]{numprint} % Pretty print numbers
\npthousandsep{\,} % Use small space as thousand separator
\npdecimalsign{\ensuremath{.}} % Use period as decimal sign

% % Fonts, including double stroke and blackboard fonts
\RequirePackage{amsfonts} % e.g. blackboard letters \mathbb{} 
% \RequirePackage{amssymb} % could use instead of amsfonts?
% \RequirePackage{bm} % Bold math fonts
\RequirePackage{dsfont} % \mathds{} for double stroke fonts
\RequirePackage[lm]{sfmath} % Sans Serif maths
\RequirePackage{soulutf8} % Strikeout, underlining etc. with support for UTF-8 symbols

% Graphics and colors
\RequirePackage{graphicx}
\RequirePackage{adjustbox}
\RequirePackage{xcolor} % already loaded by acl package..
\RequirePackage{tcolorbox}

% Tables (nowadays only tblr)
\RequirePackage{tabularray}
\UseTblrLibrary{amsmath}
\UseTblrLibrary{booktabs}
\UseTblrLibrary{functional}

% Floats, subfigures
\RequirePackage{float}
\RequirePackage{stfloats}
\RequirePackage{subcaption}

% Misc
\RequirePackage{hyperref}
\hypersetup{
    colorlinks=true,
    anchorcolor=blue,
    linkcolor=blue,
    citecolor=blue,
    filecolor=magenta,
    urlcolor=blue,
    % pdfsubject={},
}

\RequirePackage{csquotes}

% \RequirePackage{varioref}
\if@cleveref
    \RequirePackage[nameinlink, noabbrev]{cleveref}
\fi

% \RequirePackage{wrapfig}
% \RequirePackage[rflt]{floatflt}

%% Commands %%
\newcommand{\tsf}[1]{\textsf{#1}}
\newcommand{\ttt}[1]{\texttt{#1}}
\newcommand{\npp}[1]{\numprint[\%]{#1}}

%% Math Operators %%

% Models
\DeclareMathOperator{\LSTM}{\ensuremath{\mathsf{LSTM}}}
\DeclareMathOperator{\BiLSTM}{\ensuremath{\mathsf{BiLSTM}}}
\DeclareMathOperator{\Linear}{\ensuremath{\mathsf{Linear}}}
\DeclareMathOperator{\Dropout}{\ensuremath{\mathsf{Dropout}}}
\DeclareMathOperator{\LayerNorm}{\ensuremath{\mathsf{LayerNorm}}}
\DeclareMathOperator{\ConvOneD}{\ensuremath{\mathsf{Conv1D}}}
\DeclareMathOperator{\WordEmbedding}{\ensuremath{\mathsf{WordEmbedding}}}
\DeclareMathOperator{\CharEmbedding}{\ensuremath{\mathsf{CharEmbedding}}}
\DeclareMathOperator{\LanguageModel}{\ensuremath{\mathsf{LanguageModel}}}
\DeclareMathOperator{\SubwordPooling}{\ensuremath{\mathsf{SubwordPooling}}}
\DeclareMathOperator{\TreeLSTM}{\ensuremath{\mathsf{TreeLSTM}}}
\DeclareMathOperator{\StackLSTM}{\ensuremath{\mathsf{StackLSTM}}}

% Language Modelling
\DeclareMathOperator{\similar}{\ensuremath{sim}}
\DeclareMathOperator{\tokenizer}{\ensuremath{\mathit{tokenize}}}
\DeclareMathOperator{\embed}{\ensuremath{\mathit{embed}}}

% Misc
\DeclareMathOperator{\mean}{\ensuremath{\mathit{mean}}}
\newcommand{\vv}[2][b]{\vec{\vphantom{#1}#2}}

% Performance Measures
\DeclareMathOperator{\precision}{\ensuremath{\mathit{precision}}}
\DeclareMathOperator{\recall}{\ensuremath{\mathit{recall}}}
\DeclareMathOperator{\fone}{\ensuremath{\mathit{F_1}}}

%% Environments %%
\if@minted
    \RequirePackage[newfloat=true]{minted}
    \RequirePackage{mdframed}

    \AtBeginEnvironment{snugshade*}{\vspace{-\FrameSep}}
    \AfterEndEnvironment{snugshade*}{\vspace{-\FrameSep}}

    \AtBeginEnvironment{minted}{\renewcommand{\fcolorbox}[4][]{#4}}

    % Add frames above and below the minted environment
    %%begin novalidate
    \BeforeBeginEnvironment{minted}{\begin{mdframed}[rightline=false,leftline=false,linewidth=0.6pt]}
            \AfterEndEnvironment{minted}{\end{mdframed}}
    %%end novalidate

    \setminted{fontsize=\footnotesize,mathescape,autogobble,breaklines,tabsize=4}
    \newminted{cypher}{fontsize=\footnotesize,mathescape,linenos,autogobble,texcomments=true,breaklines}
    \newminted{python}{fontsize=\footnotesize,mathescape,linenos,autogobble,python3,escapeinside=||}
    \newminted[longpythoncode]{python}{fontsize=\footnotesize,mathescape,linenos,autogobble,python3,escapeinside=||,frame=lines}
\fi

% Custom float environments using newfloat
\if@minted
    \SetupFloatingEnvironment{listing}{name=Listing}
\else
    \RequirePackage{newfloat}
    \DeclareFloatingEnvironment[
        name=Listing,
        placement=h,
        within=section
    ]{listing}
\fi
\captionsetup[listing]{position=top,skip=-8pt}
\floatname{listing}{Listing}
\if@cleveref
    \crefname{listing}{listing}{listings}
    \Crefname{listing}{Listing}{Listings}
\fi
\AtEndEnvironment{listing}{\vspace{-14pt}}

\DeclareFloatingEnvironment[
    name=Algorithm,
    listname={List of Algorithms},
    placement=h,
    within=section
]{algorithm}
\captionsetup[algorithm]{position=top,skip=-8pt}
\floatname{algorithm}{Algorithm}
\if@cleveref
    \crefname{algorithm}{algorithm}{algorithms}
    \Crefname{algorithm}{Algorithm}{Algorithms}
\fi
\AtEndEnvironment{algorithm}{\vspace{-14pt}}

\DeclareFloatingEnvironment[
    name=Query,
    listname={List of Queries},
    placement=h,
    within=section
]{query}
\captionsetup[query]{position=top,skip=-8pt}
\floatname{query}{Query}
\if@cleveref
    \crefname{query}{query}{queries}
    \Crefname{query}{Query}{Queries}
\fi
\AtEndEnvironment{query}{\vspace{-14pt}}

\providecommand{\listofqueries}{\listof{query}{\listofqueriescaption}}

\if@tikz
    %% TikZ und Co. %%
    \usepackage{tikz}
    \usetikzlibrary{arrows.meta}
    \usetikzlibrary{arrows}
    \usetikzlibrary{automata}
    \usetikzlibrary{babel}
    \usetikzlibrary{backgrounds}
    \usetikzlibrary{calc}
    \usetikzlibrary{calendar}
    \usetikzlibrary{chains}
    \usetikzlibrary{decorations.pathmorphing}
    \usetikzlibrary{decorations.pathreplacing}
    \usetikzlibrary{er}
    \usetikzlibrary{fit}
    \usetikzlibrary{matrix}
    \usetikzlibrary{mindmap}
    \usetikzlibrary{patterns.meta}
    \usetikzlibrary{patterns}
    \usetikzlibrary{positioning}
    \usetikzlibrary{scopes}
    \usetikzlibrary{shadings}
    \usetikzlibrary{shadows}
    \usetikzlibrary{shapes.arrows}
    \usetikzlibrary{shapes.callouts}
    \usetikzlibrary{shapes.geometric}
    \usetikzlibrary{shapes.misc}
    \usetikzlibrary{shapes.multipart}
    \usetikzlibrary{shapes.symbols}
    \usetikzlibrary{through}
    \usetikzlibrary{topaths}

    \usepackage[linguistics]{forest}

    \usepackage{pgf,pgfplots,etoolbox}
    \pgfplotsset{compat=newest}
\fi

\mode<all>
